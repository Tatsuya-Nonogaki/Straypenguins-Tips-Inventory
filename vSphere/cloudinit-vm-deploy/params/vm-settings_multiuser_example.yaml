# Example vm-settings.yaml with multi-user support for cloudinit-linux-vm-deploy.ps1
# This demonstrates the new user1, user2, ... feature

# == Infrastructure (vCenter Connection) ==
vcenter_host: vcenter01.backyard.local
vcenter_user: administrator@vsphere.local
vcenter_password: "KenFiat50s^"

# == VM Hardware/Placement ==
template_vm_name: rhel9-tpl
new_vm_name: multiuser01
datacenter_name: VMDATACENTER
cluster_name: CLST_A
datastore_name: ProdStore
seed_iso_copy_store: "[COMMSTORE01] cloudinit-iso/"
resource_pool_name: Resources
esxi_host: vhost-a01
dvs_portgroup: PROD_LAN01
cpu: 3
memory_mb: 4096
disk_format: Thick
disks:
  - name: Hard disk 1
    size_gb: 50
  - name: Hard disk 2
    size_gb: 8
  - name: Hard disk 3
    size_gb: 5

swaps:
  1: /dev/sdb1

resize_fs:
  - /dev/sdc1

# == OS/Cloud-init Parameters ==
hostname: multiuser01
instance_id: multiuser01-20251122
fqdn: multiuser01.production.local

netif1:
  netdev: ens192
  ip_addr: 192.168.0.11
  prefix: 24
  gateway: 192.168.0.254
  dnsaddresses:
    - 192.168.0.201
    - 192.168.0.202
  ignore_auto_routes: yes
  ignore_auto_dns: yes
  ipv6_disable: yes

# == Multi-User Configuration (NEW FEATURE) ==
# Define multiple users with user1, user2, ... keys
# The "primary" user is used for in-guest operations (VMware Tools commands)

user1:
  name: admin01
  primary: true  # This user will be selected for in-guest operations
  password: "AdminPass123!"
  password_hash: "$6$rounds=656000$YourHashHere123$abcdef..."
  user_groups: "wheel,adm,systemd-journal"
  ssh_keys:
    - "ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEArandomkey1... admin01@workstation"
    - "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIrandomkey2... admin01@laptop"

user2:
  name: deploy01
  password: "DeployPass456!"
  password_hash: "$6$rounds=656000$YourHashHere456$ghijkl..."
  user_groups: "wheel"
  ssh_keys:
    - "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCrandomkey3... deploy01@ci-server"

user3:
  name: monitor01
  password: "MonitorPass789!"
  password_hash: "$6$rounds=656000$YourHashHere789$mnopqr..."
  user_groups: "systemd-journal"
  ssh_keys:
    - "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCrandomkey4... monitor01@monitoring"

# == Legacy single-user fields (for backward compatibility) ==
# These are automatically populated from the primary user (user1 in this example)
# You can also specify them explicitly for legacy templates that don't use userN
# username: admin01  # Auto-populated from user1.name
# password: "AdminPass123!"  # Auto-populated from user1.password
# user_groups: "wheel,adm,systemd-journal"  # Not auto-mapped, only for legacy templates
# ssh_keys:  # Not auto-mapped, only for legacy SSH_KEYS placeholder
#   - "ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEArandomkey1..."

# == Script tuning parameters ==
cloudinit_wait_sec: 600
cloudinit_poll_sec: 10
cloudinit_tools_wait_sec: 60
cloudinit_tools_poll_sec: 10
cloudinit_backoff_sec: 60
